// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int      @id @default(autoincrement())
  email       String   @unique
  name        String
  passwordHash String  @map("password_hash")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  projects    Project[]
  studySessions StudySession[]

  @@map("users")
}

model Project {
  id          Int      @id @default(autoincrement())
  name        String
  description String?  @db.Text
  ownerId     Int      @map("owner_id")
  isPublic    Boolean  @default(false) @map("is_public")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  owner       User @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  questionSets QuestionSet[]

  @@map("projects")
}

model QuestionSet {
  id          Int      @id @default(autoincrement())
  projectId   Int      @map("project_id")
  name        String
  description String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  project     Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  questions   Question[]
  studySessions StudySession[]

  @@map("question_sets")
}

model Question {
  id            Int      @id @default(autoincrement())
  questionSetId Int      @map("question_set_id")
  questionText  String   @db.Text @map("question_text")
  answerText    String?  @db.Text @map("answer_text")
  difficulty    Int?     @default(1) // 1-5 scale
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  // Relations
  questionSet   QuestionSet @relation(fields: [questionSetId], references: [id], onDelete: Cascade)
  sessionAnswers SessionAnswer[]

  @@map("questions")
}

model StudySession {
  id            Int       @id @default(autoincrement())
  userId        Int       @map("user_id")
  questionSetId Int       @map("question_set_id")
  mode          String    @default("front-to-end") // "front-to-end" or "shuffle"
  startedAt     DateTime  @default(now()) @map("started_at")
  completedAt   DateTime? @map("completed_at")

  // Relations
  user          User @relation(fields: [userId], references: [id], onDelete: Cascade)
  questionSet   QuestionSet @relation(fields: [questionSetId], references: [id], onDelete: Cascade)
  sessionAnswers SessionAnswer[]

  @@map("study_sessions")
}

model SessionAnswer {
  id          Int      @id @default(autoincrement())
  sessionId   Int      @map("session_id")
  questionId  Int      @map("question_id")
  userRating  Int      @map("user_rating") // 1-5 scale
  answeredAt  DateTime @default(now()) @map("answered_at")

  // Relations
  session     StudySession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  question    Question @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@map("session_answers")
}